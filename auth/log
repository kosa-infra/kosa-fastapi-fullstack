--- ./__init__.py
--- ./log
--- ./templates/register.html
{% extends "base.html" %} {% block title %}회원가입{% endblock %} {% block content %}
<h2>회원가입</h2>
<form method="post" action="/auth/register">
  <input type="text" name="username" placeholder="아이디" required />
  <input type="password" name="password" placeholder="비밀번호" required />
  <button type="submit">가입하기</button>
</form>
{% endblock %}
--- ./templates/base.html
<!doctype html>
<html>
  <head>
    <title>{% block title %}User Management{% endblock %}</title>
    <meta charset="UTF-8" />
    <style>
      body {
        font-family: Arial;
        max-width: 500px;
        margin: 50px auto;
      }
      input,
      button {
        width: 100%;
        padding: 10px;
        margin: 5px 0;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <nav>
      <a href="/auth/register">회원가입</a> |
      <a href="/auth/login">로그인</a>
    </nav>
    {% block content %}{% endblock %}
  </body>
</html>
--- ./templates/login.html
{% extends "base.html" %} {% block title %}로그인{% endblock %} {% block content %}
<h2>로그인</h2>
<form method="post" action="/auth/login">
  <input type="text" name="username" placeholder="아이디" required />
  <input type="password" name="password" placeholder="비밀번호" required />
  <button type="submit">로그인</button>
</form>
<script src="../static/js/use-storage.js"></script>
{% endblock %}
--- ./config.py
from pydantic_settings import BaseSettings


class Settings(BaseSettings):
    MYSQL_HOST: str
    MYSQL_PORT: int = 3306
    MYSQL_USER: str
    MYSQL_PASSWORD: str
    MYSQL_DB: str

    class Config:
        env_file = ".env"
        extra = "ignore"


settings = Settings()
--- ./database.py
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker

from auth.config import settings

SQLALCHEMY_DATABASE_URL = f"mysql://{settings.MYSQL_USER}:{settings.MYSQL_PASSWORD}@{settings.MYSQL_HOST}:{settings.MYSQL_PORT}/{settings.MYSQL_DB}"

engine = create_engine(SQLALCHEMY_DATABASE_URL)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)
Base = declarative_base()


def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
--- ./routers/__init__.py
--- ./routers/auth.py
from fastapi import APIRouter, Depends, Form, HTTPException, Request
from fastapi.responses import HTMLResponse
from fastapi.templating import Jinja2Templates
from sqlalchemy.exc import IntegrityError
from sqlalchemy.orm import Session

from auth.database import get_db  # ✅ DB 의존성
from auth.models import UserDB  # ✅ MySQL UserDB 모델

router = APIRouter()
templates = Jinja2Templates(directory="./templates")  # ✅ 상위 templates 폴더


@router.get("/register", response_class=HTMLResponse)
async def register_page(request: Request):
    return templates.TemplateResponse("register.html", {"request": request})


@router.post("/register")
async def register(
    username: str = Form(...), password: str = Form(...), db: Session = Depends(get_db)
):
    # ✅ MySQL에서 username 중복 체크
    existing_user = db.query(UserDB).filter(UserDB.username == username).first()
    if existing_user:
        raise HTTPException(status_code=400, detail="Username already exists")

    # ✅ MySQL에 사용자 저장
    user = UserDB(username=username, password=password)
    db.add(user)
    try:
        db.commit()
        db.refresh(user)
        return {"message": "User created successfully"}
    except IntegrityError:
        db.rollback()
        raise HTTPException(status_code=400, detail="Username already exists")


@router.get("/login", response_class=HTMLResponse)
async def login_page(request: Request):
    return templates.TemplateResponse("login.html", {"request": request})


@router.post("/login")
async def login(
    username: str = Form(...), password: str = Form(...), db: Session = Depends(get_db)
):
    # ✅ MySQL에서 사용자 조회
    user = db.query(UserDB).filter(UserDB.username == username).first()
    if not user or user.password != password:
        raise HTTPException(status_code=401, detail="Invalid credentials")
    return {"isLogin": True, "username": username}
--- ./models.py
from pydantic import BaseModel
from sqlalchemy import Column, Integer, String

from auth.database import Base


class UserDB(Base):
    __tablename__ = "users"
    id = Column(Integer, primary_key=True, index=True)
    username = Column(String(50), unique=True, index=True)
    password = Column(String(255))


class UserCreate(BaseModel):
    username: str
    password: str


class User(BaseModel):
    id: int
    username: str

    class Config:
        from_attributes = True
--- ./main.py
from fastapi import FastAPI
from fastapi.staticfiles import StaticFiles
from fastapi.templating import Jinja2Templates

from auth.database import engine
from auth.models import Base
from auth.routers.auth import router as auth_router

app = FastAPI()
templates = Jinja2Templates(directory="templates")

app.mount("/static", StaticFiles(directory="auth/static"), name="static")

app.include_router(auth_router, prefix="/auth", tags=["auth"])
Base.metadata.create_all(bind=engine)


@app.get("/")
async def root():
    return {"message": "FastAPI User Management with MySQL Config"}
